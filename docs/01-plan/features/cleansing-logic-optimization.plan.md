# [Plan] 클렌징 로직 최적화 (Cleansing Logic Optimization)

## 1. 개요 (Overview)
현재 `geminiService.ts`를 통해 수행되는 텍스트 클렌징 작업은 단순한 패턴(인용 링크 제거, 각주 마커 제거 등)을 처리하는 데에도 Gemini API 호출이 필요하며, 이로 인해 약 15초 내외의 지연 시간이 발생함. Perplexity나 NotebookLM의 결과물에서 나타나는 단순하고 반복적인 패턴은 정규표현식(Regex)과 일반 로직으로 충분히 처리가 가능하므로, 이를 로컬에서 즉시 처리할 수 있는 기능을 추가하여 UX를 개선하고자 함.

## 2. 목표 (Goals)
- **속도 개선**: 15초 내외의 처리 시간을 1초 미만으로 단축.
- **정확도 유지**: 기존 AI가 수행하던 링크 및 마커 제거 기능을 정규표현식으로 동일하게 구현.
- **유연성**: 단순 패턴은 로컬에서, 복잡한 문맥 파악이 필요한 경우는 AI를 사용하는 하이브리드 구조 또는 선택 옵션 제공.

## 3. 대상 패턴 분석 (Pattern Analysis)
`example/perplexity답변_before.txt` 기준:
- **인용 링크**: `[title](url)` 형식. 예: `[blog.naver](https://...)`
- **각주 마커**: `[1]`, `[1, 2]`, `[1-3]` 등.
- **기타 기호**: `⭐` 등의 장식용 기호.

## 4. 상세 작업 내용 (Tasks)
- [ ] **패턴 추출 및 정규표현식 정의**:
    - Citation links: `/\[[^\]]+\]\(https?:\/\/[^\)]+\)/g`
    - Footnote markers: `/\[\d+(?:,\s*\d+)*(?:-\d+)*\]/g`
- [ ] **로컬 클렌징 서비스 구현**:
    - `services/localCleansingService.ts` 생성.
    - `CleansingConfig` 옵션에 따른 정규표현식 적용 로직 구현.
- [ ] **서비스 통합 및 UI 수정**:
    - `App.tsx`에서 클렌징 시작 시 로컬 처리 우선 적용 또는 옵션 제공.
    - 필요 시 "Fast 모드(로컬)"와 "AI 모드(Gemini)" 선택 기능 추가.
- [ ] **검증**:
    - `example` 폴더의 before/after 파일을 사용하여 로컬 클렌징 결과 비교 테스트.

## 5. 기대 효과 (Expected Benefits)
- 사용자 대기 시간 90% 이상 단축.
- API 할당량 절약 및 비용 최적화.
- 오프라인 상태에서도 기본적인 클렌징 기능 작동 가능.
